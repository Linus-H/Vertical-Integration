\chapter{Navier Stokes Equations for Atmospheric Simulation}\label{chapter:navier_stokes}
As mentioned in the introduction our system of interest is a simplified model of weather.
This system is commonly described using a variant of the Navier Stokes Equations used for atmospheric simulation (NSE).
For this reason, in this section the NSE will first be introduced, completing the first step of \emph{modeling}.
Thereafter, some common simplifications will be introduced, and the boundary conditions of the system are discussed.
This accounts for the second step of \emph{approximating}.\\

Before the system of equations can be understood, first, the symbols used within them must be discussed.
The following table introduces the used symbols, their colloquial names, their type, and their SI-unit.

\begin{tabular}{c|c|c|c}
\hline
Symbol & Name & Type & SI-unit \\ 
\hline 
$t$ & time & variable & $s$ \\
\hline 
$\textbf{V}_3$ & wind speed & vector field & $\frac{m}{s}$ \\
\hline 
$T$ & temperature & scalar field & $K$ \\
\hline 
$\rho$ & density & scalar field & $\frac{kg}{m^3}$ \\
\hline 
$q$ & specific humidity & scalar field & $\frac{g}{kg}$ \\
\hline 
$p$ & pressure & scalar field & $\frac{N}{m^2}$ \\
\hline 
$\boldsymbol{\Omega}$ & angular velocity of Earth & constant vector & $\frac{m}{s}$ \\
\hline 
$\Phi = gz$ & \makecell{geopotential comprising effects\\ of gravity and centrifugal force} & scalar field & $\frac{J}{kg}$ \\
\hline 
$R \approx 287.0 \frac{J}{kg\cdot K}$ & perfect gas constant & scalar constant & $\frac{J}{kg\cdot K}$ \\ 
\hline 
$C_p \approx 1000 \frac{J}{kg\cdot K}$ & \makecell{specific heat at constant \\pressure for dry air} & scalar constant & $\frac{J}{kg\cdot K}$ \\ 
\hline 
$\textbf{F}$ & source/sink term for momentum & scalar field & $\frac{m}{s^2}$ \\ 
\hline 
$\textbf{Q}$ & source/sink term for heat & scalar field & $\frac{J}{mol\cdot K}$ \\ 
\hline 
$\textbf{M}$ & source/sink term for specific humidity & scalar field & $\frac{g}{s\cdot kg}$ \\ 
%\hline 
\end{tabular}
\\(TODO: source for numbers)\\

Now the only components missing to write down the NSE are the differential operators.
In the following table $A$ stands in for an arbitrary scalar field.
The third definition of $\nabla$ will be used in later sections and has been included for completeness sake.

{\tabulinesep=0.5mm
\begin{center}
\begin{tabu}{c|c|c} 
\hline
Operator Symbol & Definition & Operator Name \\ 
\hline 
$\frac{DA}{Dt}$ & $\frac{\partial A}{\partial t}+\textbf{V}_3\cdot \nabla_3A$ & material derivative \\ 
\hline 
$\nabla _3$ & $\begin{pmatrix}
\frac{\partial }{\partial x} \\ 
\frac{\partial }{\partial y} \\ 
\frac{\partial }{\partial z}
\end{pmatrix}$ & 3-dimensional nabla-operator \\
\hline 
$\nabla$ & $\begin{pmatrix}
\frac{\partial }{\partial x} \\ 
\frac{\partial }{\partial y}
\end{pmatrix}$ & 2-dimensional nabla-operator
\end{tabu}
\end{center}}


Using these definitions the most general form of the equations can be written as follows:
\begin{align}
\text{momentum equation}\;\; \frac{D\textbf{V}_3}{Dt} &= -2\boldsymbol{\Omega}\times \textbf{V}_3 - \frac{1}{\rho}\nabla _3 p - \nabla _3 \Phi + \textbf{F} \label{eq_mom}\\
\text{thermodynamic equation}\;\;\; \frac{DT}{Dt} &= \frac{R}{C_p}\frac{T}{p}\frac{Dp}{Dt}+\frac{\textbf{Q}}{C_p}\label{eq_therm}\\
\text{continuity equation}\;\;\; \frac{D\rho}{Dt} &= -\rho \nabla _3 \cdot \textbf{V}_3\label{eq_cont}\\
\text{water vapor equation}\;\;\; \frac{Dq}{Dt} &= \textbf{M}\label{eq_water}\\
\text{equation of state}\;\;\;\;\; p &= \rho R T \label{eq_state}
\end{align}
\subsubsection{Interpretation of the Terms:}
First, looking at the left sides of the above equations, it can be seen that the material derivative is used.
These material derivatives account for the fact that the physical properties of a fluid parcel need to ``travel'' along with that fluid parcel through space, e.g. when the entirety of a gas is moving to the right at a constant speed, and there happens to be a region of higher density within that gas, this high-density region quite obviously has to move right along with the gas.

Next, the right-hand sides of the above equations are interpreted, starting with the momentum equation \ref{eq_mom}:
\begin{itemize}
\item $-2\boldsymbol{\Omega}\times \textbf{V}_3$ this term describes the Coriolis effect, which needs to be modeled because the rotating earth is used as the frame of reference.
\item $- \frac{1}{\rho}\nabla _3 p$ this pressure force term describes how air flows from regions of high pressure to regions of low pressure.
\item $- \nabla _3 \Phi$ this term describes how air flows from high  potential to low potential, i.e. in the direction of gravity.
\end{itemize}
For complete accuracy a term of the shape $\frac{\mu}{\rho} \nabla _3^2 \textbf{V}_3$ accounting for the viscosity can be added.
However $\mu \approx 1.7\cdot 10^{-5}$, so the term can often be ignored.
\\
Looking at the thermodynamic equation \ref{eq_therm}, there is only a single term $\frac{R}{C_p}\frac{T}{p}\frac{Dp}{Dt}$ describing how temperature changes given how the pressure changes.
This relationship depends on temperature and pressure, because the thermodynamic properties of air also depend on the current temperature and pressure.
To be more accurate a term of the shape $\frac{\alpha R}{C_p}\nabla _3^2 T$ could be added, to account for thermal conduction, but for these equations they can be neglected, because $\alpha \approx \frac{0.024}{R\rho}$ (TODO: source) is sufficiently small.
\\
Lastly, interpreting the continuity equation \ref{eq_cont}, it can be helpful to expand the material derivative, in order to highlight how the two similar terms can describe different effects.
\begin{align*}
\frac{D\rho}{Dt} &= -\rho \nabla _3 \cdot \textbf{V}_3\\
\frac{\partial \rho}{\partial t} + \textbf{V}_3 \cdot \nabla _3 \rho &= -\rho \nabla _3 \cdot \textbf{V}_3\\
\frac{\partial \rho}{\partial t} &=  - \textbf{V}_3 \cdot \nabla _3 \rho -\rho \nabla _3 \cdot \textbf{V}_3
\end{align*}
The first term accounts for how density travels along with the flow.
The second term describes how the density of a gas is reduced if the flow is divergent, i.e. if more material flows away from a point in space than flows in, the amount of material in that point reduces.
\\
In the following the source/sink terms $\textbf{F}$, $\textbf{Q}$ and $\textbf{M}$ are set to zero, and the water vapor equation \ref{eq_water} is ignored.

\subsubsection{Categories of Equations and Variables}
The equations can be split up into two categories, depending on their function.
The first category comprises any equations describing the evolution of a variable over time.
Such equations are called \emph{prognostic}, and can be identified by their containing either a material derivative $\frac{D}{Dt}$, or a partial derivative of time $\frac{\partial}{\partial t}$.
These are the equations which need to be numerically approximated in order to simulate the system.

The second category consists of all remaining equations, which are called \emph{diagnostic}.
By method of exclusion they do not contain time derivatives, and only describe static relationships between variables at any point in time.

In the case of the ``raw'' NSE, only the equation of state \ref{eq_state} is \emph{diagnostic}, with the remaining equations being \emph{prognostic}.

Conversely, a variable is called \emph{prognostic} if its evolution is described by some \emph{prognostic} equation.
Otherwise it is called \emph{diagnostic}.

\section{Rearrangements and Simplifications}
Having written down and interpreted the NSE, it is now time to perform the second step of \emph{approximating} them.
This is done for several reasons, all of which can be boiled down to computational efficiency.
When implementing the original NSE directly, several issues arise.
\\
First, the raw equations contain some redundancy, e.g. both $\rho$ and $p$ are used in the equations, even though there is a linear relationship between the two (equation of state \ref{eq_state}).
Having to perform this conversion between the two variables during simulation is inefficient.
Getting rid of this kind of inefficiency by transforming the equations does not affect the result of simulations.
Thus, rearrangements are be called \emph{non-altering}.
\\
Second, depending on what atmospheric effects are of interest, some terms in the NSE are negligible.
Computing them would yet again be inefficient.
However, simplifying the NSE by ignoring these terms does alter the result of simulations.
For this reason simplifications are be called \emph{altering}.
\\
\\
In the following, first, some \emph{non-altering} rearrangements are made and, second, some \emph{altering} simplifications are introduced.
The former have the main goal of condensing the NSE into a more compact and efficient format.
The latter only have the goal of making computation more efficient.

%both in order to make computation more efficient, and to transform the equations into a form more conducive to making simplifications.
%These rearrangements do not affect the simulation results.
%\\
%Afterwards, some simplifications will be introduced, which do affect the simulation results, but in turn significantly reduce the computational intensity.
%\\
%This reduction in computational intensity stems from the fact that simplifications transform the nature of some of the equations from prognostic into diagnostic, thus reducing the number of differential equations to be simulated.

\subsection{Non-Altering Rearrangements}
The main goal of these rearrangements is to rewrite the NSE in a form more conducive to making assumption, although they sometimes have the nice side-effect of making computation more efficient.
These rearrangements do not change the number of prognostic equations.
They can, however, change the number of diagnostic variables, and the type (diagnostic, prognostic) of a variable.
\subsubsection{Replacing Occurrences of $\rho$ by $p$}\label{subsec_rho_p}
As mentioned above, having the NSE contain both $\rho$ and $p$ is redundant.
This makes it desirable to replace occurrences of $\rho$ by $p$.
In the NSE the only diagnostic equation containing $\rho$ is the continuity equation \ref{eq_cont} ($\rho$ in the momentum equation \ref{eq_mom} can simply be replaced using \ref{eq_state}).
Using the equation of state \ref{eq_state} and the thermodynamic equation \ref{eq_therm}, yields
\begin{align*}
\frac{D\rho}{Dt} &\stackrel{(\ref{eq_state})}{=} \frac{D\frac{p}{RT}}{Dt} = \frac{1}{RT}\frac{Dp}{Dt}-\frac{p}{RT^2}\frac{DT}{Dt}\\
&\stackrel{(\ref{eq_therm})}{=} \frac{1}{RT}\frac{Dp}{Dt}-\frac{1}{C_pT}\frac{Dp}{Dt} = \frac{1}{T}\frac{C_p-R}{RC_p}\frac{Dp}{Dt}
\end{align*}.
Now, inserting this into the continuity equation \ref{eq_cont}, we get:
\begin{align*}
\frac{1}{T}\frac{C_p-R}{RC_p}\frac{Dp}{Dt} &= \frac{D\rho}{Dt} = -\rho \nabla _3 \cdot \textbf{V}_3\\
\frac{1}{T}\frac{C_p-R}{RC_p}\frac{Dp}{Dt} &\stackrel{(\ref{eq_state})}{=} -\frac{p}{RT} \nabla _3 \cdot \textbf{V}_3\\
\frac{Dp}{Dt} &= - \frac{p}{1-\frac{R}{C_p}} \nabla _3 \cdot \textbf{V}_3
\end{align*}
This makes $\rho$ into a purely diagnostic variable, and elevates $p$ to the status of diagnostic variable.


\subsubsection{Splitting into Vertical and Horizontal Parts}
For this second rearrangement one has to look at $\Phi = gz$.
The only occurence of $\Phi$ is in the momentum equation \ref{eq_mom} in the form of $-\nabla _3 \Phi=\begin{pmatrix}0 & 0 & -g \end{pmatrix}^T $.
This means $\Phi$ only affects the vertical component of $\textbf{V}_3$.
For this reason it makes sense to split $\textbf{V}_3$ (and thus the NSE) into its vertical and horizontal components.
To this end two new variables $\textbf{V} \in \mathbb{R}^2$ and $w\in \mathbb{R}$, representing horizontal and vertical winds respectively, are introduced.
Additionally, $\boldsymbol{k}$ is the vertical vector (always perpendicular to the ground), and $f=2\Omega \sin \phi$ is the Coriolis parameter.
Assuming gravity to only act in the vertical and being constant across the atmosphere, we can write $-\nabla_3 \Phi = -g \boldsymbol{k}$.
Using these definitions to replace $\textbf{V}_3$, we end up with the following equation system:
\begin{align*}
\frac{D\textbf{V}}{Dt} &= -f\boldsymbol{k} \times \textbf{V} - \frac{RT}{p}\nabla p\\
\frac{Dw}{Dt} &= - \frac{RT}{p} \frac{\partial p}{\partial z} - g \\
\frac{DT}{Dt} &= \frac{R}{C_p}\frac{T}{p}\frac{Dp}{Dt}\\
\frac{Dp}{Dt} &= -\frac{p}{1- \frac{R}{C_p}} \left(\nabla \cdot \textbf{V} + \frac{\partial w}{\partial z}\right)
\end{align*}

\subsubsection{Using $\text{ln}p$ as a Prognostic Variable}
Looking at the NSE after having replaced $\rho$ by $p$ and split the equations into vertical and horizontal parts, it can be observed that $p$ always occurs in the pattern $\frac{1}{p}\nabla p$, $\frac{1}{p}\frac{Dp}{Dt}$, or $\frac{1}{p}\frac{\partial p}{\partial t}$.
In order to further save on computational intensity, it would be desirable not to calculate $\frac{1}{p}$.
This leads to a common transformation applied to the NSE, namely the replacement of $p$ by $\text{ln}p$, making $\text{ln}p$ a prognostic and $p$ a diagnostic variable.
The effect of this transformation can be observed by taking the derivative of $\text{ln}p$, w.r.t. some variable $\iota$, and applying the chain rule:
\begin{align*}
\frac{d\text{ln}p}{d\iota} =  \frac{1}{p}\frac{dp}{d\iota}
\end{align*}
The right side of this equation is the pattern just observed.
\\
Applying the above identity to the NSE results in the following set of equations:
\begin{align*}
\frac{D\textbf{V}}{Dt} &= -f\boldsymbol{k} \times \textbf{V} - RT\nabla \text{ln}p\\
\frac{Dw}{Dt} &= - RT \frac{\partial \text{ln}p}{\partial z} - g \\
\frac{DT}{Dt} &= \frac{RT}{C_p}\frac{D\text{ln}p}{Dt}\\
\frac{D\text{ln}p}{Dt} &= -\frac{1}{1- \frac{R}{C_p}} \left(\nabla \cdot \textbf{V} + \frac{\partial w}{\partial z}\right)
\end{align*}

\subsection{Altering Simplifications}
In the previous section the NSE have been transformed into a more handy form, without affecting the result of simulations.
In this section the NSE will be further simplified by making certain assumptions about the prognostic variables.
All of the following simplifications will result in one less prognostic equation and thus one less prognostic variable.
Having one less prognostic equation usually reduces computational efforts.
This in turn entails that the results of simulations will be changed by making these simplifications.

\subsubsection{Ignoring Horizontal Winds}\label{subsec_horizon}
As main focus of this thesis is the vertical part of the NSE, we are not interested in $\textbf{V}$ as a prognostic variable.
The most straightforward simplification to remove $\textbf{V}$ from the equations, is the assumption that $\textbf{V}=0$.
This makes turns horizontal momentum equation into a diagnostic equation stating that the horizontal gradient of pressure is zero.
The equation system resulting from this assumption is:
\begin{align*}
\nabla p &= 0\\
\frac{Dw}{Dt} &= - \frac{RT}{p} \frac{\partial p}{\partial z} - g \\
\frac{DT}{Dt} &= \frac{R}{C_p}\frac{T}{p}\frac{Dp}{Dt}\\
\frac{Dp}{Dt} &= -\frac{p}{1- \frac{R}{C_p}} \frac{\partial w}{\partial z}\\
p &= \rho R T
\end{align*}


\subsubsection{Hydrostatic Assumption}\label{subsec_hydrostat}
When simulating a region of the atmosphere, quite often the breadth of the region considered is a lot larger than its height.
For this reason, horizontal effects become dominant and it becomes sufficient to approximate the vertical.
One commonly made assumption is that the force of gravity $-\rho g$ and the vertical of the pressure gradient force $-\frac{\partial p}{\partial z}$ directly cancel each other out, i.e. their sum equals zero.
This results in the the hydrostatic assumption:
\begin{align}\label{eq_hydrostat_assump}
\frac{\partial p}{\partial z} = -\rho g 
\end{align}
As gravity and pressure gradient force are the only effects affecting the evolution of vertical wind speed $w$, this results in
\begin{align*}
\frac{Dw}{Dt} &= - \frac{1}{\rho} \frac{\partial p}{\partial z} - g = 0
\end{align*},
which removes the vertical momentum equation from the ranks of the prognostic equations, replacing it with the diagnostic hydrostatic assumption.
The resulting set of equations are:
\begin{align*}
\frac{\partial p}{\partial z} &= -\rho g \\
\frac{D\textbf{V}}{Dt} &= -f\boldsymbol{k} \times \textbf{V} - \frac{RT}{p}\nabla p\\
\frac{DT}{Dt} &= \frac{R}{C_p}\frac{T}{p}\frac{Dp}{Dt}\\
\frac{Dp}{Dt} &= -\frac{p}{1- \frac{R}{C_p}} \left(\nabla \cdot \textbf{V} + \frac{\partial w}{\partial z}\right)\\
\end{align*}


%\subsubsection{Assuming Constant Temperature}
%The last simplification does not have any real-world applications, because it is very inaccurate, but is instead useful for testing implementations of the equation systems.
%For this simplification it is assumed that temperature is constant across the domain, i.e. $T=\text{const}$.
%As already mentioned, making this assumption for a domain spanning the entire vertical of the atmosphere is inaccurate.
%From this assumption it follows that $0=\frac{DT}{Dt}=\nabla _3T$
%This has an effect on two equations.
%First, the thermodynamic equation \ref{eq_therm} becomes irrelevant (DIAGNOSTIC $0=\frac{Dp}{Dt}$!?!%)
%Second, the rewriting of the continuity equation \ref{eq_cont} in section \ref{subsec_rho_p} can be simplified, it was assumed there that $\frac{DT}{Dt}\neq 0$.
%Keeping this in mind, the equations can be written as follows:
%\begin{align*}
%\frac{D\textbf{V}}{Dt} &= -f\boldsymbol{k} \times \textbf{V} - %\frac{RT}{p}\nabla p\\
%\frac{Dw}{Dt} &= - \frac{RT}{p} \frac{\partial p}{\partial z} - g \\
%\frac{Dp}{Dt} &= -p (\nabla \cdot \textbf{V} + \frac{\partial w}{\partial z})
%\end{align*}

\section{Alternative Coordinate Systems}
When simulating the NSE, boundaries within which to simulate have to be chosen.
Assuming $\textbf{V}=0$, i.e. the equation system from section \ref{subsec_horizon} is used, the only boundaries left to be chosen are the vertical ones.
Using the equations in section \ref{subsec_horizon} these vertical boundaries can only be described by specifying the vertical lower and upper bound by their relative heights to sea level, i.e. $z_{\text{bottom}}$ and $z_{\text{top}}$ respectively.
\\
In order to simulate a column of the atmosphere, it would be desirable to have $z_{\text{bottom}}$ be located at ground level, and $z_{\text{top}}$ at the top of the atmosphere.
\\
However, specifying the boundaries directly by their height relative to sea level, has several disadvantages.
First, the ground is not flat, meaning the value of $z_{\text{bottom}}$ is dependent on location.
Second, there is no clear end to the atmosphere, meaning there is no obvious single value $z_{\text{top}}$ at which to stop simulating.
\\
Considering these problems, it would be desirable not to measure height in meters relative to sea level, but by some other measure.
And as there is no other obvious measurement of height that would optimal, instead a placeholder variable for measuring height $s$ is introduced.
This way any possible other measurement of height can easily be plugged in.
\subsubsection*{Identities to get from $z$ to $s$:}
Considering that the old measurement of height $z$ used in the NSE was suboptimal and $s$ is supposed to replace it, this means that all occurrences of $z$ in the NSE need to be replaced by $s$.
%Often, $s$ will be dependent on pressure $p$ in some way, as this way an equidistant spacing of $s$ will correspond to higher spacial resolution in areas where $p$ is changing a lot.\\
This change from $z$ to $s$ as a vertical coordinate affects all differential operators in the NSE, meaning all of them need to be rewritten.
\\
First, the horizontal derivative w.r.t. $x$ or $y$ will be rewritten.
In the NSE it was always implicitly assumed that derivatives w.r.t. $x$ and $y$ were calculated at constant height $z$.
This can be denoted by a subscript $\left(\frac{\partial A}{\partial x}\right)_z$ (where $A$ is a placeholder for any scalar or vector field).
We are interested in $\left(\frac{\partial A}{\partial x}\right)_s$, i.e. the partial derivative of $A$ w.r.t. $x$ at constant $s$.
According to \cite{kasahara1974various} this can be written as (for formula for $y$ is analogous):
\begin{align*}
\left(\frac{\partial A}{\partial x}\right)_s &= \left( \frac{\partial A}{\partial x}\right)_z + \frac{\partial A}{\partial z}\left(\frac{\partial z}{\partial s}\right)_s
\end{align*}
To interpret this term, one can to imagine the two-dimensional surface comprising all points in space having the property of $s=s_0$.
As $s$ is a measurement of height, for every vertical specified by $(x,y)$ there is exactly one point in the vertical with the property of $s=s_0$.
\\
$\left(\frac{\partial A}{\partial x}\right)_s$ can be interpreted as the change in the value of $A$ when moving in the direction of $x$ and changing height $z$ in order stay on the surface $s=s_0$.
Infinitesimally speaking, this change in value of $A$ can be decomposed into two parts.
First, the change of $A$ due to moving in the direction of $x$ at a constant height $z$: $\left( \frac{\partial A}{\partial x}\right)_z$.
Second, the change in $A$ due to having to move vertically in order to stay on the surface $s=s_0$.
This terms magnitude depends on both how much vertical movement was necessary $\left(\frac{\partial z}{\partial s}\right)_s$, and on how much $A$ changes with $z$: $\frac{\partial A}{\partial z}$. 
Using this identity a new horizontal derivative operator $\nabla_s$ can be introduced:
\begin{align}
\nabla _s A &= \nabla _z A+\frac{\partial s}{\partial z}(\nabla _sz)\frac{\partial A}{\partial s}\label{id_h_diff}
\end{align}

Using Leibnitz's notation, the replacement for vertical spacial derivatives can be rewritten as follows:
\begin{align}
\frac{\partial A}{\partial z} &= \frac{\partial s}{\partial z} \frac{\partial A}{\partial s}\label{id_v_diff}
\end{align}

Lastly, as the material derivative was not dependent on the vertical coordinate system, according to \cite{kasahara1974various} it can be written (with $\dot{s}=\frac{ds}{dt}$ being a generalized version of vertical wind speed, i.e. how much distance $ds$ along the height measurement $s$ does a fluid parcel cover in a time $dt$):
\begin{align}
\frac{D}{Dt} &= \left(\frac{\partial}{\partial t}\right)_s + \textbf{V} \cdot \nabla _s + \dot{s}\frac{\partial }{\partial s}\label{id_t_diff}
\end{align}


%To this end, the following identities are used, with $c\in\{x,y\}$ \cite{kasahara1974various}:
%\begin{align}
%\begin{split}
%\left(\frac{\partial A}{\partial c}\right)_s &= \left( \frac{\partial A}{\partial c}\right)_z + \frac{\partial A}{\partial z}(\frac{\partial z}{\partial s})_s\\
%\Rightarrow \nabla _s A &= \nabla _z A+\frac{\partial s}{\partial z}(\nabla _sz)\frac{\partial A}{\partial s}\\
%\frac{\partial A}{\partial z} &= \frac{\partial s}{\partial z} \frac{\partial A}{\partial s}\\
%\frac{D}{Dt} &= (\frac{\partial}{\partial t})_s + \textbf{V} \cdot \nabla _s + \dot{s}\frac{\partial }{\partial s}
%\end{split}\label{eq_s_identities}
%\end{align}


\subsection{Non-Hydrostatic Equations:}
Using these equations, the thermodynamic equation \ref{eq_therm} becomes:
\begin{align*}
\frac{DT}{Dt} &= \frac{R}{C_p}\frac{T}{p}\frac{Dp}{Dt}\\
\frac{\partial T}{\partial t} &\stackrel{(\ref{id_t_diff})}{=} -\textbf{V} \cdot \nabla _s T - \dot{s} \frac{\partial T}{\partial s}+\frac{RT}{C_p}\frac{D\text{ln}p}{Dt}
\end{align*}
For the other equations a somewhat paradoxical step has to be taken.
In order to derive the non-hydrostatic Navier Stokes equations, hydrostatic pressure $\pi$ is introduced as a proxy-variable.
This is done in order to express $\frac{\partial s}{\partial z}$ in equation \ref{id_v_diff}.
Hydrostatic pressure $\pi$ has the properties:
\begin{align}
\frac{\partial \pi}{\partial z} &= -\rho g = - \frac{p}{RT}g \nonumber \\
\pi(z) &= \int_\infty ^z \rho g dz' \nonumber \\
\Rightarrow \frac{\partial s}{\partial z} &= \frac{\partial s}{\partial \pi}\frac{\partial \pi}{\partial z} = - g\rho\left(\frac{\partial \pi}{\partial s}\right)^{-1} = - g\frac{p}{RT}\left(\frac{\partial \pi}{\partial s}\right)^{-1} \label{eq_ds_dz}
\end{align}
Now introducing $\frac{\partial \pi}{\partial s}$ as a new diagnostic variable, equation \ref{id_v_diff} can be rewritten:
\begin{align}
\frac{\partial A}{\partial z} &= \frac{\partial s}{\partial z} \frac{\partial A}{\partial s}\nonumber\\
&\stackrel{\ref{eq_ds_dz}}{=} - g\frac{p}{RT}\left(\frac{\partial \pi}{\partial s}\right)^{-1}\frac{\partial A}{\partial s}\label{id_v_diff2}
\end{align}
Using $\frac{\partial \pi}{\partial s}$, the equation for vertical wind can be written as:
\begin{align*}
\frac{Dw}{Dt} &= - \frac{RT}{p} \frac{\partial p}{\partial z} - g\\
&\stackrel{(\ref{id_v_diff2})}{=} g \left(\frac{\partial \pi}{\partial s}\right)^{-1}\frac{\partial p}{\partial s} - g\\
&= -g\left(1 - \frac{\partial p}{\partial s}\left(\frac{\partial \pi}{\partial s}\right)^{-1}\right)
\end{align*}
In a similar fashion using $\frac{\partial \pi}{\partial s}$ as a new variable, the equation for pressure becomes (in the last line $\Phi = zg$ is exploited):
\begin{align*}
\frac{D\text{ln}p}{Dt} &= -\frac{1}{1- \frac{R}{C_p}} \left(\nabla_z \cdot \textbf{V} + \frac{\partial w}{\partial z}\right)\\
&\stackrel{(\ref{id_h_diff} \& \ref{id_v_diff})}{=} -\frac{1}{1- \frac{R}{C_p}} \left(\nabla _s \cdot \textbf{V} - \frac{\partial s}{\partial z} (\nabla _sz)\cdot \frac{\partial \textbf{V}}{\partial s} + \frac{\partial s}{\partial z}\frac{\partial w}{\partial s}\right)\\
&\stackrel{(\ref{eq_ds_dz})}{=} -\frac{1}{1- \frac{R}{C_p}} \left(\nabla _s \cdot \textbf{V} + \frac{p}{RT}\left(\frac{\partial \pi}{\partial s}\right)^{-1} (\nabla _s \Phi)\cdot\frac{\partial \textbf{V}}{\partial s} - g\frac{p}{RT}\left(\frac{\partial \pi}{\partial s}\right)^{-1} \frac{\partial w}{\partial s}\right)\\
\end{align*}

Now that $\frac{\partial \pi}{\partial s}$ is a new diagnostic equation, it needs its own diagnostic equation, which can be gained by starting from the continuity equation \ref{eq_cont}.
Utilizing the above identities, it can be shown that the following equations hold:
\begin{align*}
\text{original equation:}~~~~ \frac{d}{dt}\left(\text{ln}\rho\right) &+ \nabla _z \cdot \textbf{V} + \frac{\partial w}{\partial z} = 0 \\
\frac{d}{dt}\left(\text{ln}\left(\rho\frac{\partial z}{\partial s}\right)\right) &+ \nabla _s \cdot \textbf{V} + \frac{\partial \dot{s}}{\partial s} = 0\\
\frac{\partial}{\partial t}\left(\rho\frac{\partial z}{\partial s}\right) &= - \nabla _s \cdot \left(\rho\frac{\partial z}{\partial s}\textbf{V}\right) - \frac{\partial }{\partial s}\left(\rho\frac{\partial z}{\partial s}\dot{s}\right)
\end{align*}
Utilizing, $\rho\frac{\partial z}{\partial s} \stackrel{(\ref{eq_ds_dz})}{=} - \frac{1}{g}\frac{\partial \pi}{\partial s}$, we finally get a diagnostic equation for $\frac{\partial \pi}{\partial s}$.
\begin{align*}
\frac{\partial}{\partial t}\left(\frac{\partial \pi}{\partial s}\right) &= - \nabla _s \cdot \left(\frac{\partial \pi}{\partial s}\textbf{V}\right) - \frac{\partial }{\partial s}\left(\frac{\partial \pi}{\partial s}\dot{s}\right)
\end{align*}
Integrating this equation from $s_{top}$ to $s$, gives a diagnostic equation for $\dot{s}$:
\begin{align*}
\dot{s}\frac{\partial \pi}{\partial s} = -\int _{s_{top}}^s\nabla _s \cdot \left(\frac{\partial \pi}{\partial s}\textbf{V}\right)ds' + \frac{\partial \pi}{\partial \pi_{\text{bottom}}} \int  _{s_{top}}^{s_{bottom}} \nabla _s \cdot \left(\frac{\partial \pi}{\partial s}\textbf{V}\right) ds
\end{align*}

Now making the assumption that horizontal winds are zero again, i.e. $\textbf{V}=0$, using the above relation necessitates that $\dot{s}=0$.
These two statements result in the following equation system:
\begin{align*}
\frac{\partial w}{\partial t} &= -g\left(1 - \frac{\partial p}{\partial s}\left(\frac{\partial \pi}{\partial s}\right)^{-1}\right) \\
\frac{\partial \text{ln}p}{\partial t} &= \frac{g}{1- \frac{R}{C_p}} \frac{p}{RT}\left(\frac{\partial \pi}{\partial s}\right)^{-1} \frac{\partial w}{\partial s}\\
\frac{\partial T}{\partial t} &= \frac{RT}{C_p}\frac{\partial \text{ln}p}{\partial t}\\
\frac{\partial}{\partial t}\left(\frac{\partial \pi}{\partial s}\right) &= 0
\end{align*}
Note that for $\textbf{V}=\dot{s}=0$, the material derivative and partial derivative are the same:
\begin{align*}
\frac{D}{Dt} = \left(\frac{\partial}{\partial t}\right)_s + \textbf{V} \cdot \nabla _s + \dot{s}\frac{\partial }{\partial s} = \left(\frac{\partial}{\partial t}\right)_s
\end{align*}
\\
Now that the NSE have been rewritten in the $s$-coordinate system, the $s$-coordinates have to be defined.
One way of defining the vertical coordinate, according to Laprise \cite{laprise1992euler}, is implicitly by defining using two functions $f$ and $h$, and with $\pi_0$ and $\pi _{bottom}$ being a reference pressure and hydrostatic pressure at the bottom, respectively:
\begin{align*}
\pi (s) = f(s)\pi_0 + h(s)\pi_{bottom}
\end{align*}
Using this equation, and integrating equation (\ref{eq_ds_dz}) with respect to $s$, we can get:
\begin{align*}
z(s) = z_{bottom} + \frac{R}{g}\int _s ^{s_{bottom}} \frac{T}{p}\left(\pi_0 \frac{\partial f}{\partial s} + \pi_{bottom} \frac{\partial h}{\partial s}\right)ds'
\end{align*}
W.l.o.g. it is assumed that $s=0$ at the top of the system and $s=1$ at the bottom, from which it follows that:
\begin{align*}
\pi(1) = \pi_{bottom} \Rightarrow f(1) = 0 , h(1) = 1
\end{align*}
Also, assuming pressure at the top of the atmosphere is nonexistent:
\begin{align*}
\pi(0) = 0 \Rightarrow f(0) = 0, h(0) = 0
\end{align*}
Other than these restrictions, $f$ and $g$ can be chosen arbitrarily, as long as $\left(\pi_0 \frac{\partial f}{\partial s} + \pi_{bottom} \frac{\partial h}{\partial s}\right)$ is positive for $s\in[0;1]$, as this ensures that $z(s)$ is monotonically falling.

\subsection{Hydrostatic Equations:}
Yet another equation system can be gained by making use of the hydrostatic assumption from section \ref{subsec_hydrostat}.

\section{Boundary Conditions}
discussion of how each of the state variables should behave at the boundaries of the system
\begin{itemize}
\item winds are zero at upper and lower boundary
\item density is zero at upper boundary
\item integral over density in vertical needs to be constant over time. (preservation of mass)
\item Temperature ?
\item pressure is zero at upper boundary
\item pressure and density at lower boundary ?
\end{itemize}

